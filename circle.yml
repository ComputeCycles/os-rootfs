
machine:
  services:
    - docker

dependencies:
  pre:
    - sudo apt-get update
    - sudo apt-get install -y qemu qemu-user-static binfmt-support debootstrap --no-install-recommends

test:
  override:
    - make amd64
    - make i386
    - make arm64
    - make armhf
    - make mips

deployment:
  release:
    tag: /v.*/
    owner: hypriot
    commands:
      - github-release upload --user hypriot --repo os-rootfs --tag $CIRCLE_TAG --file rootfs-amd64.tar.gz --name rootfs-amd64.tar.gz
      - github-release upload --user hypriot --repo os-rootfs --tag $CIRCLE_TAG --file rootfs-i386.tar.gz --name rootfs-i386.tar.gz
      - github-release upload --user hypriot --repo os-rootfs --tag $CIRCLE_TAG --file rootfs-arm64.tar.gz --name rootfs-arm64.tar.gz
      - github-release upload --user hypriot --repo os-rootfs --tag $CIRCLE_TAG --file rootfs-armhf.tar.gz --name rootfs-armhf.tar.gz
      - github-release upload --user hypriot --repo os-rootfs --tag $CIRCLE_TAG --file rootfs-mips.tar.gz --name rootfs-mips.tar.gz
